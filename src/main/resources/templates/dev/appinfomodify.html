<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <!-- Meta, title, CSS, favicons, etc. -->
  <meta charset="utf-8">

  <title>APP后台管理系统</title>

  <!-- Bootstrap -->
  <link th:href="@{/css/bootstrap.min.css}" rel="stylesheet">
  <!-- Font Awesome -->
  <link th:href="@{/css/font-awesome.min.css}" rel="stylesheet">
  <!-- NProgress -->
  <link th:href="@{/css/nprogress.css}" rel="stylesheet">
  <!-- iCheck -->
  <link th:href="@{/css/green.css}" rel="stylesheet">
  <!-- bootstrap-progressbar -->
  <link th:href="@{/css/bootstrap-progressbar-3.3.4.min.css}" rel="stylesheet">
  <!-- JQVMap -->
  <link th:href="@{/css/jqvmap.min.css}" rel="stylesheet"/>
  <!-- Custom Theme Style -->
  <link th:href="@{/css/custom.min.css}" rel="stylesheet">
  <!-- add localcss 2016-8-21 -->
  <link th:href='@{/localcss/applist.css}' rel='stylesheet'>
  <link rel="stylesheet" th:href="@{/css/bootstrap.css}"></link>
  <script  th:src="@{/js/jquery.js}"></script>
  <script type="text/javascript" th:src="@{/localjs/appcheck.js}"></script>
</head>
<div class="clearfix"></div>
<div class="row">
  <div class="col-md-12 col-sm-12 col-xs-12">
    <div class="x_panel">
      <div class="x_title">
        <h2>修改APP基础信息 <i class="fa fa-user"></i><small th:text="${session.login_user.devname}"></small></h2>
             <div class="clearfix"></div>
      </div>
      <div class="x_content">
	  <!-- <div class="item form-group">
               <label class="control-label col-md-3 col-sm-3 col-xs-12" ></label>
               <div class="col-md-6 col-sm-6 col-xs-12">
                 <form action="uploadlogo" class="dropzone" style="height:100px;">
                 </form>
            <div class="clearfix"></div>
         </div>
       </div> -->
           <div class="clearfix"></div>
        <form class="form-horizontal form-label-left" action="appinfoaddsave" method="post" enctype="multipart/form-data">
          <div class="item form-group">
            <label class="control-label col-md-3 col-sm-3 col-xs-12" for="name">软件名称 <span class="required">*</span>
            </label>
            <div class="col-md-6 col-sm-6 col-xs-12">
              <input id="softwareName" class="form-control col-md-7 col-xs-12"
               data-validate-length-range="20" data-validate-words="1" name="softwarename"  required="required"
               placeholder="请输入软件名称" type="text" th:value="${appInfo.softwarename}" >
            </div>
          </div>
          <div class="item form-group">
            <label class="control-label col-md-3 col-sm-3 col-xs-12" for="name">APK名称 <span class="required">*</span>
            </label>
            <div class="col-md-6 col-sm-6 col-xs-12">
              <input id="APKName" class="form-control col-md-7 col-xs-12" 
              	data-validate-length-range="20" data-validate-words="1" name="apkname"   required="required"
              	placeholder="请输入APK名称" type="text" th:value="${appInfo.apkname}" >
            </div>
          </div>
          
          <div class="item form-group">
            <label class="control-label col-md-3 col-sm-3 col-xs-12" for="name">支持ROM <span class="required">*</span>
            </label>
            <div class="col-md-6 col-sm-6 col-xs-12">
              <input id="supportROM" class="form-control col-md-7 col-xs-12" name="supportrom"
              	data-validate-length-range="20" data-validate-words="1"   required="required"
              	placeholder="请输入支持的ROM" type="text" th:value="${appInfo.supportrom}" >
            </div>
          </div>
          <div class="item form-group">
            <label class="control-label col-md-3 col-sm-3 col-xs-12" for="name">界面语言 <span class="required">*</span>
            </label>
            <div class="col-md-6 col-sm-6 col-xs-12">
              <input id="interfaceLanguage" class="form-control col-md-7 col-xs-12" 
              data-validate-length-range="20" data-validate-words="1" name="interfacelanguage"   required="required"
              placeholder="请输入软件支持的界面语言" type="text" th:value="${appInfo.interfacelanguage}" >
            </div>
          </div>
          <div class="item form-group">
            <label class="control-label col-md-3 col-sm-3 col-xs-12" for="number">软件大小 <span class="required">*</span>
            </label>
            <div class="col-md-6 col-sm-6 col-xs-12">
              <input type="number" id="softwareSize" name="softwaresize"   required="required" onkeyup="value=value.replace(/[^\d]/g,'')"
              data-validate-minmax="10,500"  placeholder="请输入软件大小，单位为Mb" class="form-control col-md-7 col-xs-12" th:value="${appInfo.softwaresize}">
            </div>
          </div>
          
          <div class="item form-group">
            <label class="control-label col-md-3 col-sm-3 col-xs-12" for="number">下载次数 <span class="required">*</span>
            </label>
            <div class="col-md-6 col-sm-6 col-xs-12">
              <input type="number" id="downloads" name="downloads"   required="required"
              data-validate-minmax="10,500"  placeholder="请输入下载次数" class="form-control col-md-7 col-xs-12" th:value="${appInfo.downloads}" >
            </div>
          </div>
          
          <div class="item form-group">
            <label class="control-label col-md-3 col-sm-3 col-xs-12"  for="select"  >所属平台 <span class="required">*</span></label>

            <div class="col-md-6 col-sm-6 col-xs-12"  >
              <select name="flatformid" id="flatformId" class="form-control"   required="required" >

              </select>
            </div>
          </div>
          
          <div class="item form-group">
            <label class="control-label col-md-3 col-sm-3 col-xs-12" for="select">一级分类 <span class="required">*</span></label>
            <div class="col-md-6 col-sm-6 col-xs-12">
              <select name="categorylevel1" id="categoryLevel1" class="form-control"   required="required"> </select>

            </div>
          </div>
          
          <div class="item form-group">
            <label class="control-label col-md-3 col-sm-3 col-xs-12"  for="select">二级分类 <span class="required">*</span></label>
            <div class="col-md-6 col-sm-6 col-xs-12">
              <select name="categorylevel2" id="categoryLevel2" class="form-control"  required="required"></select>
            </div>
          </div>
          
          <div class="item form-group">
            <label class="control-label col-md-3 col-sm-3 col-xs-12" for="select">三级分类 <span class="required">*</span></label>
            <div class="col-md-6 col-sm-6 col-xs-12">
              <select name="categoryLevel3" id="categoryLevel3" class="form-control"  required="required"></select>
            </div>
          </div>
          <div class="item form-group">
            <label class="control-label col-md-3 col-sm-3 col-xs-12" for="name">APP状态 <span class="required">*</span>
            </label>
            <div class="col-md-6 col-sm-6 col-xs-12">
              <input type="text" class="form-control col-md-7 col-xs-12"
                     th:value="${appInfo.statusName}" readonly="readonly" name="statusname">
            </div>
          </div>
          <div class="item form-group">
            <label class="control-label col-md-3 col-sm-3 col-xs-12" for="textarea">应用简介 <span class="required">*</span>
            </label>
            <div class="col-md-6 col-sm-6 col-xs-12">
              <textarea class="form-control col-md-7 col-xs-12" readonly="readonly" id="textarea" th:text="${appInfo.appinfo}" name="appinfo">
              </textarea>
            </div>
          </div>
          <div class="item form-group">
            <label class="control-label col-md-3 col-sm-3 col-xs-12" for="name">LOGO图片 <span class="required">*</span>
            </label>
            <div class="col-md-6 col-sm-6 col-xs-12" th:switch="${appInfo.logopicpath}">
              <div th:case="null">
                暂无
              </div>
              <img  th:case="*" th:src="${appInfo.logopicpath }" width="100px;"/>

            </div>



          </div>
          <div class="ln_solid"></div>
          <div class="form-group">
            <div class="col-md-6 col-md-offset-3" th:if="${appInfo.statusName} =='待审核'">
              <button id="send" type="submit" class="btn btn-success">保存</button>
              <button type="button" class="btn btn-primary" id="back">返回</button>
              <br/><br/>
            </div>
            <div class="col-md-6 col-md-offset-3" th:if="${appInfo.statusName} =='审核未通过'">
              <button id="send" type="submit" class="btn btn-success">保存并再次提交审核</button>
              <button id="save" type="submit" class="btn btn-success">保存</button>
              <button type="button" class="btn btn-primary" id="back">返回</button>
              <br/><br/>
            </div>

          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<script th:inline="javascript">

  $(function(){
    //动态加载所属平台列表
    $.ajax({
      type:"GET",//请求类型
      url:"flatlist.json",//请求的url
      data:{tcode:"APP_FLATFORM"},//请求参数
      dataType:"json",//ajax接口（请求url）返回的数据类型
      success:function(data){//data：返回数据（json对象）
        var flatname = [[${appInfo.flatformName}]];
        var valueid = [[${appInfo.flatformid}]];
        $("#flatformId").html("");
        var options = "<option value=\""+valueid+"\">"+flatname+"</option>";
        for(var i = 0; i < data.length; i++){
          options += "<option value=\""+data[i].valueid+"\">"+data[i].valuename+"</option>";
        }
        $("#flatformId").html(options);
      },
      error:function(data){//当访问时候，404，500 等非200的错误状态码
        alert("加载平台列表失败！");
      }
    });

    //动态加载一级分类列表
    $.ajax({
      type:"GET",//请求类型
      url:"categorylevellist.json",//请求的url
      data:{pid:null},//请求参数
      dataType:"json",//ajax接口（请求url）返回的数据类型
      success:function(data){//data：返回数据（json对象）
        // appInfo.getCategoryLevel1Name()
        var level1name = [[${appInfo.getCategoryLevel1Name()}]];
        var level1id = [[${appInfo.categorylevel1}]];
        var level2name = [[${appInfo.getCategoryLevel2Name()}]];
        var level2id = [[${appInfo.categorylevel2}]];
        $("#categoryLevel1").html("");
        var options = "<option value=\""+level1id+"\">"+level1name+"</option>";
        for(var i = 0; i < data.length; i++){
          options += "<option value=\""+data[i].id+"\">"+data[i].categoryname+"</option>";
        }
        $("#categoryLevel1").html(options);
        $("#categoryLevel2").html("");
        var options2 = "<option value=\""+level2id+"\">"+level2name+"</option>";
        for(var i = 0; i < data.length; i++){
          options2 += "<option value=\""+data[i].id+"\">"+data[i].categoryname+"</option>";
        }
        $("#categoryLevel2").html(options2);

        var level3name = [[${appInfo.getCategoryLevel3Name()}]];
        var level3id = [[${appInfo.categorylevel3}]];
        $("#categoryLevel3").html("");
        var options3 = "<option value=\""+level3id+"\">"+level3name+"</option>";
        for(var i = 0; i < data.length; i++){
          options3 += "<option value=\""+data[i].id+"\">"+data[i].categoryname+"</option>";
        }
        $("#categoryLevel3").html(options3);
      },
      error:function(data){//当访问时候，404，500 等非200的错误状态码
        alert("加载一级分类列表失败！");
      }
    });
    //动态加载二级分类列表
    $("#categoryLevel1").change(function(){
      var categoryLevel1 = $("#categoryLevel1").val();
      if(categoryLevel1 != '' && categoryLevel1 != null){
        $.ajax({
          type:"GET",//请求类型
          url:"categorylevellist.json",//请求的url
          data:{pid:categoryLevel1},//请求参数
          dataType:"json",//ajax接口（请求url）返回的数据类型
          success:function(data){//data：返回数据（json对象）

            $("#categoryLevel2").html("");
            var options = "<option value=\"\">-请选择-</option>";
            for(var i = 0; i < data.length; i++){
              options += "<option value=\""+data[i].id+"\">"+data[i].categoryname+"</option>";
            }
            $("#categoryLevel2").html(options);
          },
          error:function(data){//当访问时候，404，500 等非200的错误状态码
            alert("加载二级分类失败！");
          }
        });
      }else{
        $("#categoryLevel2").html("");
        var options = "<option value=\"\">--请选择--</option>";
        $("#categoryLevel2").html(options);
      }
      $("#categoryLevel3").html("");
      var options = "<option value=\"\">--请选择--</option>";
      $("#categoryLevel3").html(options);
    });
    //动态加载三级分类列表
    $("#categoryLevel2").change(function(){
      var categoryLevel2 = $("#categoryLevel2").val();
      if(categoryLevel2 != '' && categoryLevel2 != null){
        $.ajax({
          type:"GET",//请求类型
          url:"categorylevellist.json",//请求的url
          data:{pid:categoryLevel2},//请求参数
          dataType:"json",//ajax接口（请求url）返回的数据类型
          success:function(data){//data：返回数据（json对象）
            $("#categoryLevel3").html("");
            var options = "<option value=\"\">-请选择-</option>";
            for(var i = 0; i < data.length; i++){
              options += "<option value=\""+data[i].id+"\">"+data[i].categoryname+"</option>";
            }
            $("#categoryLevel3").html(options);
          },
          error:function(data){//当访问时候，404，500 等非200的错误状态码
            alert("加载三级分类失败！");
          }
        });
      }else{
        $("#categoryLevel3").html("");
        var options = "<option value=\"\">--请选择--</option>";
        $("#categoryLevel3").html(options);
      }
    });

    $("#back").on("click",function(){
      window.location.href = "list";
    });

    $("#APKName").bind("change",function(){
      //ajax后台验证--APKName是否已存在
      $.ajax({
        type:"GET",//请求类型
        url:"apkexist.json",//请求的url
        data:{APKName:$("#APKName").val()},//请求参数
        dataType:"json",//ajax接口（请求url）返回的数据类型
        success:function(data){//data：返回数据（json对象）
          if(data.APKName == "empty"){//参数APKName为空，错误提示
            alert("APKName为不能为空！");
          }else if(data.APKName == "exist"){//账号不可用，错误提示
            alert("该APKName已存在，不能使用！");
          }else if(data.APKName == "noexist"){//账号可用，正确提示
            alert("该APKName可以使用！");
          }
        },
        error:function(data){//当访问时候，404，500 等非200的错误状态码
          alert("请求错误！");
        }
      });
    });

  });


</script>